import{r as l,j as e,f as b,a as w}from"./index-3a55f404.js";import{T as N}from"./Main-93152efa.js";import{a as p}from"./api-6c4aed90.js";import{a as C}from"./index-e59a6ce4.js";import{L as S}from"./index-2274eb4d.js";import{F as k}from"./FadeLoader-67dce3f5.js";import{h as v}from"./api-d470eb0d.js";import{A as R}from"./index-af17fb20.js";/* empty css              */import"./MainLayout-42d91e61.js";import"./iconBase-10535e60.js";import"./index-81d1c8e2.js";function _({materials:c}){const{theme:m}=l.useContext(N);return e.jsx("div",{className:"entries-container",children:c?c.map(t=>e.jsx("a",{href:`/entertainment/materials/${t.id}`,className:"entry",children:e.jsxs("div",{className:"related-entry",children:[e.jsx("div",{className:"img-container",children:e.jsx("img",{src:t.image_upload||t.image,alt:""})}),e.jsx("div",{className:"title",children:e.jsx("span",{children:t.title&&t.title.length>35?t.title.slice(0,36):t.title})})]})},t.id)):e.jsx(k,{color:m==="light"?"#350d0b":"#f5f5f5"})})}function $({api:c,handleAddRelatedEntries:m,handleClose:t}){const[x,g]=l.useState([]),u=l.useRef(null),[d,f]=l.useState([]);async function y(){var n,o;if(((n=u.current)==null?void 0:n.value.length)===0){g([]);return}try{const i=await c.get(`search/?title=${(o=u.current)==null?void 0:o.value}`);if(i.status===200){const h=await i.data;g(h)}}catch(i){v(i)}}return e.jsxs("div",{className:"related-entries-popup",children:[e.jsx("div",{children:e.jsx("input",{onInput:y,ref:u,type:"text",placeholder:"Search..."})}),e.jsx("div",{children:x.length>0&&x.map(n=>e.jsxs("div",{children:[e.jsx("div",{children:e.jsx("img",{src:n.image_upload||n.image})}),e.jsx("h6",{children:n.title.length>25?n.title.slice(0,26)+"...":n.title}),e.jsx("button",{onClick:o=>{var h;const i=(h=o.target.parentElement)==null?void 0:h.parentElement;i==null||i.classList.toggle("selected"),d.includes(n)?f(d.filter(j=>j.id!==n.id)):f(j=>[...j,n])},children:d.includes(n)?"unselect":"select"})]}))}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{d.length>0?m(d):alert("Please select related entries befor adding")},children:"Add selected"}),e.jsx("button",{onClick:t,children:"Close"})]})]})}function Y(){const{id:c}=b(),{theme:m}=l.useContext(N),[t,x]=l.useState(),[g,u]=l.useState(!1),[d,f]=l.useState(!1),[y,n]=l.useState(!1);async function o(){var a;try{const s=await p.get(`materials/${c}/`);if(s.status===200){const r=await s.data;document.title=r.title+" - Entertainment",x(r)}}catch(s){s instanceof R&&((a=s.response)==null?void 0:a.status)===404&&(window.location.href="/entertainment/not-found"),v(s)}}async function i(a){try{const s=await p.patch(`materials/${c}/`,a);if(s.status===202){const r=await s.data;x(r)}}catch(s){v(s)}o()}async function h(){try{(await p.delete(`materials/${c}/`)).status===204&&window.history.back()}catch(a){v(a)}}async function j(a){try{if((await p.patch(`materials/${c}/`,{relatives:[...(t==null?void 0:t.relatives).map(r=>r.id),...a.map(r=>r.id)]})).status===202)for(const r of a)(await p.patch(`materials/${r.id}/`,{relatives:[...r.relatives,c]})).status===202&&o()}catch(s){v(s)}}function E(){n(!0)}return l.useEffect(()=>{o()},[]),l.useEffect(()=>{if(t&&t.locked){const a=document.createElement("div"),s=document.querySelector(".material-page");a.className="locked",a.innerHTML=`
        <div>
          <h2>&quot;${t.title}&quot; is locked</h2>
          ${t.lock_reason?`
          <br>
          <h3>You must either finish or delete <a style="text-decoration-line: underline !important;" href="/goals/${t.lock_reason}">this goal</a> first.</h3>
          `:""}
          
        </div>
      `,s==null||s.appendChild(a)}},[t]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"page material-page",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"material-container",children:[e.jsx("div",{className:"image-container",children:e.jsx("img",{src:t.image_upload||t.image,alt:""})}),e.jsxs("div",{children:[e.jsx("h2",{className:"title",children:t.title}),e.jsx("br",{}),e.jsx("div",{className:"genres",children:t.genres.map((a,s)=>e.jsx("span",{children:a},s))}),e.jsx("br",{}),e.jsxs("div",{className:"rates",children:[d?e.jsxs("div",{children:[e.jsx("input",{type:"number",min:"1",max:"10",step:"0.5",defaultValue:t.rate?t.rate:1,autoFocus:!0}),e.jsx("button",{onClick:a=>{var s,r;i({rate:(r=(s=a.target.parentElement)==null?void 0:s.firstElementChild)==null?void 0:r.value}),f(!1)},children:e.jsx(C,{style:{pointerEvents:"none"}})})]}):e.jsxs("span",{style:{cursor:"pointer"},title:"set average rate",onClick:()=>{f(!0)},children:["Avg rate: ",t.rate?t.rate+"/10":"N/A"]}),g?e.jsxs("div",{children:[e.jsx("input",{type:"number",min:"1",max:"10",step:"0.5",defaultValue:t.user_rate?t.user_rate:1,autoFocus:!0}),e.jsx("button",{onClick:a=>{var s,r;i({user_rate:(r=(s=a.target.parentElement)==null?void 0:s.firstElementChild)==null?void 0:r.value}),u(!1)},children:e.jsx(C,{style:{pointerEvents:"none"}})})]}):e.jsxs("span",{style:{cursor:"pointer"},title:"set your rate",onClick:()=>{u(!0)},children:["My rate: ",t.user_rate?t.user_rate+"/10":"N/A"]})]}),e.jsx("br",{}),e.jsx("a",{href:t.link,target:"_blank",className:"link",children:t.link})]}),e.jsxs("div",{children:[e.jsxs("select",{onChange:a=>{i({status:a.target.value})},className:"status",defaultValue:t.status,children:[e.jsx("option",{selected:t.status==="current",value:"current",children:"current"}),e.jsx("option",{selected:t.status==="done",value:"done",children:"done"}),e.jsx("option",{selected:t.status==="future",value:"future",children:"future"})]}),e.jsx("button",{onClick:()=>{i({special:!t.special})},className:t.special?"special":"",children:t.special?"Special":"Not Special"})]}),e.jsx("div",{className:"desc",children:e.jsx("p",{dangerouslySetInnerHTML:{__html:t.description}})}),e.jsx("button",{onClick:h,className:"delete",children:"Delete"})]}),e.jsx("div",{className:"line-sep"}),e.jsxs("div",{className:"related-entries",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Related Entries"}),e.jsx("button",{onClick:E,children:e.jsx(S,{})})]}),e.jsx("br",{}),t.relatives&&t.relatives.length>0&&e.jsx("div",{children:e.jsx(_,{materials:t.relatives})})]})]}):e.jsx(k,{color:m==="light"?"#350d0b":"#f5f5f5",height:18,width:6})}),y&&w.createPortal(e.jsx($,{api:p,handleAddRelatedEntries:j,handleClose:()=>n(!1)}),document.querySelector(".related-entries > div:nth-child(1)"))]})}export{Y as default};
