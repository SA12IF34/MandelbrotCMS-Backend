import{r,j as e}from"./index-3a55f404.js";import{L as k,a as p}from"./index-2274eb4d.js";import{a as I}from"./Main-755d3160.js";import{S as j,L as O}from"./Mission-ac96cf18.js";import{A as L}from"./index-af17fb20.js";import{c as f,h as P}from"./api-d470eb0d.js";import"./iconBase-10535e60.js";/* empty css              */import"./MainLayout-42d91e61.js";import"./index-e59a6ce4.js";import"./index-81d1c8e2.js";import"./FadeLoader-67dce3f5.js";function X({title:M}){const[g,w]=r.useState(!1),[c,E]=r.useState([]),[v,d]=r.useState([]),[a,u]=r.useState(null),[N,A]=r.useState([]),[l,R]=r.useState(null),b=r.useRef(null),y=r.useRef(null),o=r.useRef(null),h=r.useRef(null),S=r.useRef(null);r.useEffect(()=>{document.title=M},[]);async function F(s){if(s.length===0){d([]);return}try{const t="https://api.cms.saifchan.online/",i=await f(t+"sessions_manager/apis/").get("projects/?search="+s),n=await f(t+"learning_tracker/apis/").get("courses/?search="+s);if(i.status===200&&n.status===200){const m=await i.data,C=await n.data;d([...m,...C])}}catch(t){t instanceof L&&t.status===500&&alert("Something went wrong, please try again."),console.log("Error: /n",t)}}async function _(s){try{const t=await f("https://api.cms.saifchan.online/entertainment/apis/").get("search/?title="+s);if(t.status===200){const i=await t.data;A(i)}}catch(t){t instanceof L&&t.status===500&&alert("Something went wrong, please try again."),console.log("Error: /n",t)}}async function D(){var s,t,i;if(c.length===0){alert("You must have at least one mission to create a list.");return}try{const n=c.map(x=>(x.related&&delete x.related,x)),m={list:{title:(s=b.current)==null?void 0:s.value,date:(t=y.current)==null?void 0:t.value,reward:l?l.id:null,lock_reward:(i=S.current)==null?void 0:i.checked},missions:n};(await I.post("lists/",m)).status===201&&window.location.assign("/central")}catch(n){return P(n)}}function q(){var t,i,n;if(((i=(t=o.current)==null?void 0:t.textContent)==null?void 0:i.length)===0){alert("Fill mission content before adding it.");return}const s={content:(n=o.current)==null?void 0:n.textContent,project:a&&(a==null?void 0:a.type)==="project"?a.id:null,course:a&&(a==null?void 0:a.type)==="course"?a.id:null,related:a};E([...c,s]),u(null),d([]),w(!1)}return e.jsx("div",{className:"page create-list-page",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault()},className:"list-form",action:"",children:[e.jsxs("section",{className:"main-info",children:[e.jsx("input",{autoComplete:"off",ref:b,type:"text",id:"list-title",placeholder:"Missions List Title",required:!0}),e.jsx("input",{ref:y,type:"date",name:"",id:"list-date",placeholder:"Date Of Execution",required:!0})]}),e.jsx(j,{}),e.jsxs("section",{className:"missions",children:[e.jsxs("div",{className:"label",children:[e.jsx("h2",{children:"Missions"}),e.jsx("button",{onClick:()=>{o.current&&h.current&&(o.current.textContent="",h.current.value=""),u(null),d([]),w(s=>!s)},className:"add-mission",children:g?e.jsx(p,{}):e.jsx(k,{})})]}),c.length>0&&e.jsx("br",{}),e.jsx("div",{className:"missions-container list",children:c.length>0&&c.map(s=>e.jsx(O,{mission:s,readonly:!0}))}),g&&e.jsxs("div",{className:"mission-create-form",children:[e.jsx("div",{ref:o,className:"custom-textarea",contentEditable:!0,"data-placeholder":"Mission Content"}),e.jsx("span",{className:"sep"}),e.jsx("div",{className:"related-obj-field",children:a?e.jsxs("div",{className:"related-obj",children:[e.jsx("h3",{children:a.title}),e.jsx("button",{title:"remove related object",onClick:()=>{u(null)},children:e.jsx(p,{})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"search-field",children:e.jsx("input",{ref:h,onInput:s=>{F(s.target.value)},type:"text",name:"",id:"",placeholder:"Type Project or Course Titles"})}),e.jsx("div",{className:"obj-search-results",children:v.length>0&&v.map(s=>e.jsx("div",{onClick:()=>{u({id:s.id,title:s.title,type:s.start_date?"project":"course"})},children:e.jsx("span",{children:s.title})}))})]})}),e.jsx("button",{onClick:q,className:"add-mission-2",children:e.jsx(k,{})})]})]}),e.jsx(j,{}),e.jsxs("section",{className:"reward",children:[e.jsx("div",{className:"label",children:e.jsx("h2",{children:"Reward"})}),e.jsx("br",{}),e.jsxs("div",{className:"reward-form",children:[e.jsx("div",{className:"reward-search",children:e.jsxs("div",{className:"search-field",children:[e.jsx("input",{onInput:s=>{_(s.target.value)},type:"text",placeholder:"Type reward title or part of it"}),e.jsx("div",{className:"rewards-container",children:N.length>0&&N.map(s=>e.jsxs("div",{onClick:()=>{R(s)},children:[e.jsx("img",{src:s.image,alt:""}),e.jsx("h4",{children:s.title})]}))})]})}),l&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"sep"}),e.jsxs("div",{className:"chosen-reward",children:[e.jsx("div",{className:"reward-img",children:e.jsx("img",{src:l.image})}),e.jsxs("div",{className:"reward-info",children:[e.jsx("h4",{children:l.title.length>29?l.title.slice(0,30)+"...":l.title}),e.jsxs("div",{children:[e.jsxs("label",{className:"switch",children:[e.jsx("input",{ref:S,id:"lock-reward",type:"checkbox"}),e.jsx("span",{className:"slider"})]}),e.jsx("label",{htmlFor:"lock-reward",children:"Lock Reward"})]})]}),e.jsx("button",{title:"remove reward",onClick:()=>{R(null)},children:e.jsx(p,{})})]})]})]})]}),e.jsx(j,{}),e.jsx("button",{onClick:D,className:"submit-btn",type:"submit",children:"Create List"})]})})}export{X as default};
