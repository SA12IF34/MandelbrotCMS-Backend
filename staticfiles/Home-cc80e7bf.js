import{r as d,b as M,j as e}from"./index-3a55f404.js";import{I as p,L as R,S as k}from"./Mission-ac96cf18.js";import{b as _}from"./index-ee7d2108.js";import{A as L}from"./index-af17fb20.js";import"./Main-755d3160.js";import{c as q,b as G,d as T,e as Y}from"./api-d470eb0d.js";import{F as B}from"./FadeLoader-67dce3f5.js";import"./index-e59a6ce4.js";import"./iconBase-10535e60.js";/* empty css              */import"./MainLayout-42d91e61.js";import"./index-81d1c8e2.js";const P="/assets/cards-0ed33bbb.svg",f=q("https://api.cms.saifchan.online/missions/apis/");function se({title:S}){var D,y,N,b;const[o,E]=d.useState(),[C,v]=d.useState("loading"),[m,$]=d.useState("list"),[l,F]=d.useState(),I=M();d.useEffect(()=>{document.title=S,A()},[]),d.useEffect(()=>{if(m==="cards")if(window.matchMedia("(max-width: 545px)").matches){console.log("works");const t=document.querySelectorAll(".missions-container.cards .missions-card");console.log(t);const a=s=>{s.onclick=()=>{var r,i,h;console.log("something"),t.forEach(c=>{var n;(n=c.parentElement)==null||n.classList.remove("active")}),(r=s.parentElement)==null||r.classList.add("active"),(h=(i=s.parentElement)==null?void 0:i.parentElement)==null||h.classList.add(s.classList[0])}};t.forEach(a)}else{console.log("no works");const t=document.querySelectorAll(".missions-container.cards > span"),a=s=>{s.onmouseover=()=>{var r;t.forEach(i=>{i.classList.remove("active")}),s.classList.add("active"),(r=s.parentElement)==null||r.classList.add(s.classList[0])},s.onmouseleave=()=>{var r;s.classList.remove("active"),(r=s.parentElement)==null||r.classList.remove(s.classList[0]),t.forEach(i=>{i.classList.contains("working")&&i.classList.add("active")})}};t.forEach(a)}},[m]);async function A(){var t;try{let a=new Date;const s=a.getDate().toString(),r=(a.getMonth()+1).toString();a=`${a.getFullYear()}-${r.length===2?r:"0"+r}-${s.length===2?s:"0"+s}`;const h=await f.get("lists/today/"+a+"/");if(h.status===200){const c=await h.data;if((t=c.missions)==null||t.forEach(async n=>{n.project?(n.related=await G(n.project),n.related&&(n.related.route="/sessions-manager/projects/")):n.course&&(n.related=await T(n.course),n.related&&(n.related.route="/learning-tracker/courses/"))}),c.reward){const n=await Y(c.reward);F(n)}$(c.style),E(c),v("loaded")}}catch(a){return a instanceof L?a.status===404?(console.log("hello 404"),v("loaded")):(a.status===401||a.status===403)&&I("/login/"):console.log(a),null}}async function O(t,a){try{const s=await f.patch(`missions/${t}/`,a);if(s.status===202)return!0;s.status===200&&window.location.reload()}catch(s){s instanceof L&&(s.status===500||s.status===400)&&alert("Something wen wrong, please try again."),console.log(`Error :
`,s)}}async function w(t){try{(await f.post("set-cookie/",{key:"list_style",value:t,life:"long"})).status===200&&window.location.reload()}catch{alert("Something went wrong try again later.")}}function g(t){var a,s,r;(r=(s=(a=t.target)==null?void 0:a.parentElement)==null?void 0:s.querySelector(".related-object"))==null||r.classList.toggle("show"),t.target.classList.toggle("extend")}function x(t){t.dataTransfer.setData("text",t.target.id)}function u(t){t.preventDefault()}async function j(t,a){t.preventDefault();const s=t.dataTransfer.getData("text");await O(parseInt(s.split("-")[1]),{status:a})&&t.target.appendChild(document.getElementById(s))}return e.jsx("div",{className:"home-page page",children:o?o.done?e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"list-title",children:"You have done today's list!"}),e.jsx(k,{}),l&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:"Your Reward"}),e.jsx("br",{}),e.jsx("div",{className:"reward-container",children:e.jsxs("a",{href:`/entertainment/materials/${l.id}/`,children:[e.jsx("div",{className:"reward-img",children:e.jsx("img",{src:l.image,alt:""})}),e.jsx("h3",{children:l.title})]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"list-style",children:[e.jsx(_,{onClick:()=>{w("list")},title:"List"}),e.jsx("img",{onClick:()=>{w("cards")},title:"Cards",id:"CardsIco",src:P,alt:""})]}),e.jsx("h2",{className:"list-title",children:o.title}),e.jsx("br",{}),e.jsx("div",{className:`missions-container ${m==="cards"?"cards":"list"}`,children:m==="cards"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"pending",children:e.jsxs("div",{className:"missions-card pending-card",children:[e.jsx("h3",{children:"Pending"}),e.jsx("div",{className:"missions",onDrop:t=>{j(t,"pending")},onDragOver:u,children:(D=o.missions)==null?void 0:D.filter(t=>t.status==="pending").map(t=>e.jsxs("div",{id:`mission-${t.id}`,draggable:"true",onDragStart:x,onDrop:a=>{a.preventDefault()},children:[e.jsx("p",{children:t.content}),t.related&&e.jsxs(e.Fragment,{children:[e.jsx("a",{href:`${t.related.route}${t.related.id}`,target:"_blank",className:"related-object",children:e.jsx("span",{children:t.related.title})}),e.jsx("button",{onClick:g,className:"extend-mission-btn",children:e.jsx(p,{})})]})]}))})]})}),e.jsx("span",{className:"working active",children:e.jsxs("div",{className:"missions-card working-card",children:[e.jsx("h3",{children:"Being Done"}),e.jsx("div",{className:"missions",onDrop:t=>{j(t,"working")},onDragOver:u,children:(y=o.missions)==null?void 0:y.filter(t=>t.status==="working").map(t=>e.jsxs("div",{id:`mission-${t.id}`,draggable:"true",onDragStart:x,onDrop:a=>{a.preventDefault()},children:[e.jsx("p",{children:t.content}),t.related&&e.jsxs(e.Fragment,{children:[e.jsx("a",{href:`${t.related.route}${t.related.id}`,target:"_blank",className:"related-object",children:e.jsx("span",{children:t.related.title})}),e.jsx("button",{onClick:g,className:"extend-mission-btn",children:e.jsx(p,{})})]})]}))})]})}),e.jsx("span",{className:"done",children:e.jsxs("div",{className:"missions-card done-card",children:[e.jsx("h3",{children:"Done"}),e.jsx("div",{className:"missions",onDrop:t=>{j(t,"done")},onDragOver:u,children:(N=o.missions)==null?void 0:N.filter(t=>t.status==="done").map(t=>e.jsxs("div",{id:`mission-${t.id}`,draggable:"true",onDragStart:x,onDrop:a=>{a.preventDefault()},children:[e.jsx("p",{children:t.content}),t.related&&e.jsxs(e.Fragment,{children:[e.jsx("a",{href:`${t.related.route}${t.related.id}`,target:"_blank",className:"related-object",children:e.jsx("span",{children:t.related.title})}),e.jsx("button",{onClick:g,className:"extend-mission-btn",children:e.jsx(p,{})})]})]}))})]})})]}):(b=o.missions)==null?void 0:b.map(t=>e.jsx(R,{mission:t,readonly:!1}))}),l&&e.jsxs(e.Fragment,{children:[e.jsx(k,{}),e.jsx("h2",{children:"Reward"}),e.jsx("br",{}),e.jsx("div",{className:`reward-container ${l.locked&&"locked"}`,children:e.jsxs("a",{onClick:t=>{l.locked&&t.preventDefault()},href:`/entertainment/materials/${l.id}/`,children:[e.jsx("div",{className:"reward-img",children:e.jsx("img",{src:l.image,alt:""})}),e.jsx("h3",{children:l.title})]})})]})]}):e.jsx(e.Fragment,{children:C==="loading"?e.jsx(B,{color:"#c0c0c0",height:18,width:6}):e.jsx("h2",{children:"No list for today"})})})}export{se as default};
