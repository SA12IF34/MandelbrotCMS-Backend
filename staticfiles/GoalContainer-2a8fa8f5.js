import{b as U,r as o,j as e,g as C}from"./index-3a55f404.js";import{L as w,a as W}from"./index-2274eb4d.js";import{b as P,a as H}from"./index-e59a6ce4.js";import{a as z,b as B}from"./index-acd746af.js";import{a as E}from"./api-6a5d086a.js";import{A as J}from"./index-af17fb20.js";import{h as y,c as k}from"./api-d470eb0d.js";import{F as K}from"./FadeLoader-67dce3f5.js";const R="https://api.cms.saifchan.online/";function ie({form:a,id:l=null}){const d=U(),f=o.useRef(null),u=o.useRef(null),g=o.useRef(null),[x,j]=o.useState([]),[h,S]=o.useState([]),[m,v]=o.useState([]),[n,c]=o.useState([]),[r,b]=o.useState();async function G(){var s;try{const t=await E.get(`goals/${l}/`);if(t.status===200){const i=await t.data;document.title=i.title,b(i),j((i==null?void 0:i.projects)||[]),S((i==null?void 0:i.courses)||[]),v((i==null?void 0:i.missions)||[]),c((i==null?void 0:i.rewards)||[])}}catch(t){t instanceof J&&((s=t.response)==null?void 0:s.status)===404&&d("/goals/not-found"),y(t)}}async function L(){if(confirm("Are you serious you want to delete the goal?"))try{(await E.delete(`goals/${l}/`)).status===204&&d("/goals")}catch(s){y(s)}}async function M(){var s,t,i;try{const p={title:(s=f.current)==null?void 0:s.value,description:(t=u.current)==null?void 0:t.value,projects:x.map(N=>N.id),courses:h.map(N=>N.id),missions:m,rewards:n.map(N=>N.id),finish_words:(i=g.current)==null?void 0:i.value};(await E.post("goals/",p)).status===201&&d("/goals")}catch(p){y(p)}}async function _(s){try{const t=await k(R+"sessions_manager/apis/").get("projects/?search="+s);if(t.status===200)return await t.data}catch(t){y(t)}return[]}async function D(s){try{const t=await k(R+"learning_tracker/apis/").get("courses/?search="+s);if(t.status===200)return await t.data}catch(t){y(t)}return[]}async function $(s){try{const t=await k(R+"entertainment/apis/").get("search/?title="+s);if(t.status===200)return await t.data}catch(t){y(t)}return[]}async function F(s,t){try{(await k(R).patch(`missions/apis/missions/${s}/`,t)).status===202&&v(m.map(p=>(p&&p.id===s&&(window.location.reload(),p.status=t.status),p)))}catch(i){y(i)}}function A(){if(document.querySelector(".search-popup"))return;const s=document.createElement("div"),t=document.querySelector(".main-container");C.createRoot(s).render(e.jsx(q,{handleSearch:_,searchType:"projects",specified:x,setSpecified:j})),t==null||t.appendChild(s)}function T(){if(document.querySelector(".search-popup"))return;const s=document.createElement("div"),t=document.querySelector(".main-container");C.createRoot(s).render(e.jsx(q,{handleSearch:D,searchType:"courses",specified:h,setSpecified:S})),t==null||t.appendChild(s)}function I(){if(document.querySelector(".missions-popup"))return;const s=document.createElement("div"),t=document.querySelector(".main-container");C.createRoot(s).render(e.jsx(Q,{missions:m,setMissions:v})),t==null||t.appendChild(s)}function O(){if(document.querySelector(".search-popup"))return;const s=document.createElement("div"),t=document.querySelector(".main-container");C.createRoot(s).render(e.jsx(q,{handleSearch:$,searchType:"rewards",specified:n,setSpecified:c})),t==null||t.appendChild(s)}return o.useEffect(()=>{l&&!a&&G()},[]),e.jsxs("div",{className:"goal-container",children:[e.jsx("section",{className:"info",children:a?e.jsxs(e.Fragment,{children:[e.jsx("input",{ref:f,type:"text",placeholder:"Title"}),e.jsx("textarea",{ref:u,placeholder:"Description"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{children:r&&r.title}),e.jsx("p",{children:r&&r.description})]})}),e.jsxs("section",{className:"related",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"label",children:[e.jsx("h3",{children:"Projects"}),a&&e.jsx("button",{onClick:A,children:e.jsx(w,{})})]}),e.jsx("div",{children:x.map(s=>{var t;return e.jsxs("a",{target:"_blank",href:`/sessions-manager/projects/${s.id}`,className:"project",children:[e.jsx("h3",{children:s.title}),e.jsx("p",{children:s.description&&s.description.length>40?((t=s.description)==null?void 0:t.slice(0,41))+"...":s.description}),s.status==="completed"&&e.jsx("span",{children:e.jsx(P,{})})]},s.id)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"label",children:[e.jsx("h3",{children:"Courses"}),a&&e.jsx("button",{onClick:T,children:e.jsx(w,{})})]}),e.jsx("div",{children:h.map(s=>{var t;return e.jsxs("a",{target:"_blank",href:`/learning-tracker/courses/${s.id}`,className:"course",children:[e.jsx("h3",{children:s.title&&s.title.length>25?s.title.slice(0,26)+"...":s.title}),e.jsx("p",{children:s.description&&s.description.length>40?((t=s.description)==null?void 0:t.slice(0,41))+"...":s.description}),s.status==="done"&&e.jsx("span",{children:e.jsx(P,{})})]},s.id)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"label",children:[e.jsx("h3",{children:"Missions"}),a&&e.jsx("button",{onClick:I,children:e.jsx(w,{})})]}),e.jsx("div",{children:m.map(s=>e.jsxs("div",{className:"mission",children:[e.jsx("h3",{children:s.content}),a?e.jsx("button",{onClick:()=>{v(m.filter(t=>t!==s))},children:e.jsx(W,{})}):e.jsx("button",{onClick:()=>{F(s.id,{status:s.status==="done"?"pending":"done"})},children:s.status==="done"?e.jsx(P,{}):s.status==="pending"&&e.jsx(H,{})})]},s.id))})]})]}),!a&&e.jsxs("section",{className:"progress",children:[e.jsx("div",{className:"label",children:e.jsx("h3",{children:(r==null?void 0:r.progress)===100?"Done!":"Progress"})}),e.jsxs("div",{className:"progress-bar",children:[e.jsx("div",{className:"progress",style:{width:(r==null?void 0:r.progress)+"%"}}),e.jsxs("span",{className:(r==null?void 0:r.progress)===100?"done":"",style:{left:(r==null?void 0:r.progress)+"%"},children:[r==null?void 0:r.progress,"%"]})]})]}),e.jsxs("section",{className:"finish",children:[a?e.jsx("input",{ref:g,type:"text",placeholder:"Finish Words"}):r&&e.jsx("h2",{className:r.done?"":"shadow-words",children:r.finish_words}),e.jsxs("div",{className:"rewards",children:[e.jsxs("div",{className:"label",children:[e.jsx("h3",{children:"Rewards"}),a&&e.jsx("button",{onClick:O,children:e.jsx(w,{})})]}),e.jsx("div",{children:n.map(s=>e.jsxs("div",{className:"reward",children:[e.jsx("div",{className:"img",children:e.jsx("img",{src:s.image_upload||s.image,alt:""})}),e.jsxs("div",{children:[e.jsx("h3",{children:s.title.length>50?s.title.slice(0,51)+"...":s.title}),s.locked?e.jsx("span",{children:e.jsx(z,{})}):e.jsx("span",{children:e.jsx(B,{})})]})]},s.id))})]})]}),a?e.jsx("button",{onClick:M,className:"create-goal",children:"Create Goal"}):e.jsx("button",{onClick:L,className:"delete-goal",children:"Delete Goal"})]})}const Q=({missions:a,setMissions:l})=>{const d=o.useRef(null);return console.log(a),e.jsxs("div",{className:"missions-popup",children:[e.jsx("textarea",{ref:d,placeholder:"Mission content"}),e.jsx("button",{onClick:()=>{var f,u,g,x,j;(f=d.current)!=null&&f.value&&((u=d.current)==null?void 0:u.value.length)>0&&l([...a,{content:(g=d.current)==null?void 0:g.value}]),(j=(x=document.querySelector(".missions-popup"))==null?void 0:x.parentElement)==null||j.remove()},children:"Done"})]})},q=({handleSearch:a,searchType:l,specified:d,setSpecified:f})=>{const[u,g]=o.useState([]),[x,j]=o.useState(!1),[h,S]=o.useState(d),m=o.useRef(null);function v(n,c){const r=n.target;r.classList.contains("specified")?S(h.filter(b=>b.id!==c.id)):S([...h,c]),r.classList.toggle("specified")}return e.jsxs("div",{className:"search-popup",children:[e.jsxs("div",{children:[e.jsx("input",{onInput:async()=>{var n;j(!0),g(await a((n=m.current)==null?void 0:n.value)),j(!1)},ref:m,type:"text",placeholder:"Type Project or Course Titles"}),e.jsx("button",{onClick:()=>{var n,c;f(h),(c=(n=document.querySelector(".search-popup"))==null?void 0:n.parentElement)==null||c.remove()},children:"Done"})]}),e.jsx("div",{className:"search-results "+l,children:x?e.jsx(K,{}):e.jsxs(e.Fragment,{children:[(l==="projects"||l==="courses")&&u.map(n=>e.jsx("div",{onClick:c=>{v(c,n)},className:`related-obj ${h.find(c=>c.id===n.id)?"specified":""}`,children:e.jsx("h3",{children:n.title.length>30?n.title.slice(0,31)+"...":n.title})},n.id)),l==="rewards"&&u.map(n=>e.jsxs("div",{className:`reward ${h.find(c=>c.id===n.id)?"specified":""}`,onClick:c=>{v(c,n)},children:[e.jsx("div",{className:"img",children:e.jsx("img",{src:n.image_upload||n.image,alt:""})}),e.jsx("span",{children:n.title.length>15?n.title.slice(0,16)+"...":n.title})]},n.id))]})})]})};export{ie as G};
